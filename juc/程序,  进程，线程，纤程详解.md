程序,  进程，线程，纤程详解



#### 程序：

是含有指令和数据的文件 比如qq.exe



#### 进程：

分配资源的单位，为了使多个程序能够并发（同一时刻只有一个在运行，但感觉起来像多个同时运行；并行（同一时刻真的多个在运行，不是感觉像多个））的执行，操作系统需要一个结构来抽象和表示这个程序的运行。比如运行多个QQ.exe

特性：

- 进程是操作系统对一个正在运行的程序的一种抽象结构。
- 进程是指在操作系统中能独立运行并作为资源分配的基本单位，由一组机器指令、数据和堆栈等组成的能独立运行的活动实体。
- 操作系统可以同时运行多个进程，多个进程直接可以并发执行和交换信息。
- 进程在运行是需要一定的资源，如CPU、存储空间和I/O设备等。



#### 线程:

执行调度资源单位

特性：

- 线程比进程更轻量

- 线程能独立运行，独立调度，拥有资源（一般是CPU资源，程序计数器等）

- 线程调度能大幅度减小调度的成本（相对于进程来说），线程的切换不会引起进程的切换

- 线程的引入进一步提高了操作系统的并发性，线程能并发执行

- 同一个进程的多个线程共享进程的资源（省去了资源调度现场保护的很多工作）

  

#### 协程(纤程): 

- 协程是用户模式下的轻量级线程，操作系统内核对协程一无所知

- 协程的调度完全有应用程序来控制，操作系统不管这部分的调度

- 一个线程可以包含一个或多个协程

- 协程拥有自己的寄存器上下文和栈，协程调度切换时，将寄存器上下纹和栈保存起来，在切换回来时恢复先前保运的寄存上下文和栈

- 协程能保留上一次调用时的状态，看到这里各种生成器（生成器是被阉割的协程）的概念浮现出来了。。

- Windows下的实现叫纤程

- linux启动线程需要1M

  

#### 纤程(fiber):

也称绿色线程，轻量级线程，模拟线程，线程中的线程，在某些特定情况下，纤程比线程快很多，一个线程可以包含一个或多个纤程, 目前jdk没有fiber

特性:

- 线程是在Windows内核中实现的，操作系统会根据系统的调度算法对线程进行调度。
- 纤程是在用户模式下实现的，内核对纤程一无所知。
- 纤程是更轻量级的线程，一个线程可以包含一个或多个纤程
- 内核会对线程进行抢占式调度，线程一次只能执行一个纤程的代码（具体执行哪一个纤程由用户调度算法决定）
- 纤程的调度与线程的调度没有直接关系，操作系统随时可能会夺取纤程所在线程的运行权
- 除非正在运行的纤程显式的切换到另一个纤程，否则其他纤程将无法运行
- Windows有一套API来讲线程转换为纤程或者在同一个线程里面创建多个纤程

#### 管程:

跟上面的几个概念不是同一类东东，虽然长得很像，就像Car和Bar一样。

代表共享资源的数据结构以及由对该共享数据结构实施操作的一组过程所组成的资源管理程序共同构成的一个操作系统的资源管理模块。被请求和释放临界资源的进程所调用。

临界资源的概念：

- 一次只允许一个进程访问的资源
- 多个进程只能互斥访问的资源



#### 超线程

这个也是一个跟上面的概念不是一类事的概念，超线程是Intel CPU设计上的一种技术。

一个CPU物理核在同一时间只能执行一个线程，而线程的切换会消耗掉上万的始终周期，效率还不够高。超线程就是在实现同一个CPU物理核在同一时间能几乎执行两个线程的技术。这就是我们在Intel CPU的机子上的任务管理器中经常看到double的CPU物理核心的缘由。





